package com.my.board.dao;

import org.springframework.data.jdbc.repository.query.Modifying;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;

import com.my.board.entity.ReplyEntity;
import com.my.exception.FindException;
import com.my.exception.RemoveException;

public interface ReplyRepository extends JpaRepository<ReplyEntity, Integer> {

	@Query(value="SELECT *\r\n"
			+ "		FROM board_reply2 \r\n"
			+ "		WHERE reply_no = :replyNo", nativeQuery = true)
	public ReplyEntity selectByReplyNo(int replyNo) throws FindException;
	
	@Modifying
	@Query(value="DELETE board_reply2\r\n"
			+ "		WHERE reply_no=:#{#reply.replyNo}"
			, nativeQuery = true)
	public void deleteReply(ReplyEntity reply) throws RemoveException;
	
	@Query(value="SELECT level, r1.* FROM\r\n"
			+ "board_reply2 r1 START WITH reply_parent_no IS NULL\r\n"
			+ "CONNECT BY PRIOR\r\n"
			+ "reply_no = reply_parent_no", nativeQuery = true)
	public Integer selectLevelByReplyNo() throws FindException;
	
}
